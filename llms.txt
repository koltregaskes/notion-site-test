# Kol's Korner - LLM Onboarding

**Version:** 2.1.0
**Last Updated:** 25 December 2025
**Type:** Static website powered by Notion CMS

---

## What This Project Does

This is a personal blog and portfolio site that automatically pulls content from Notion and builds static HTML pages. Every hour, GitHub Actions fetches new content from Notion, generates HTML/CSS files, and deploys them to GitHub Pages. No server required - just Notion for writing and GitHub for hosting.

**In Simple Terms:**
Write in Notion → Auto-publish to website → Zero maintenance

---

## Quick Start Commands

```powershell
# Windows (PowerShell) - Set environment variables
$env:NOTION_TOKEN="secret_your_token_here"
$env:NOTION_DATABASE_ID="your_database_id_here"

# Build the site
cd "e:\My Drive\Coding\My Github\notion-site-test"
node scripts/fetch-notion.mjs

# Serve locally
cd site
npx http-server -p 8080

# Visit: http://localhost:8080/notion-site-test/
```

```bash
# Mac/Linux - Set environment variables
export NOTION_TOKEN="secret_your_token_here"
export NOTION_DATABASE_ID="your_database_id_here"

# Build the site
cd notion-site-test
node scripts/fetch-notion.mjs

# Serve locally
cd site
npx http-server -p 8080

# Visit: http://localhost:8080/notion-site-test/
```

---

## Key Files and What They Do

### Build Script (Most Important)
- **scripts/fetch-notion.mjs** (1,200+ lines)
  - The main build script - does everything
  - Fetches content from Notion API
  - Generates all HTML pages (home, posts, galleries, etc.)
  - Creates navigation, adds security headers, handles images/videos/music
  - **Key functions:**
    - `queryDatabaseAll()` - Fetches all published content from Notion
    - `writeHomePage()` - Generates home page with content grid and filters
    - `writeArticlePage()` - Converts Notion blocks to HTML articles
    - `writeGalleryPage()` - Creates image/video/music galleries with modal viewer
    - `getHeaderFooter()` - Generates navigation and footer HTML
  - **When to modify:** Adding new page types, changing layout, adding features

### Styling
- **site/styles.css** (1,400+ lines)
  - All CSS for the entire site
  - Uses CSS custom properties (design tokens)
  - Fully responsive with breakpoints at 1024px and 768px
  - **Key sections:**
    - Root variables (lines 1-50): Colours, spacing, fonts
    - Content grid (lines 1155-1262): Home page layout
    - Modal styles (lines 947-1043): Gallery viewer with navigation
    - Responsive rules (lines 1326-1380): Mobile/tablet adaptations
  - **When to modify:** Changing design, colours, layout, adding new components

### GitHub Actions
- **.github/workflows/pages.yml**
  - Runs every hour at :17 minutes past the hour
  - Builds site and deploys to GitHub Pages
  - Uses secrets: NOTION_TOKEN, NOTION_DATABASE_ID
  - **When to modify:** Changing build frequency, adding new secrets, deployment settings

### Generated Files (Do Not Edit Directly)
- **site/** - All HTML files generated by build script
  - site/index.html - Home page
  - site/posts/index.html - All articles list
  - site/tags/index.html - Tag browser
  - site/images/index.html - Image gallery
  - site/videos/index.html - Video gallery
  - site/music/index.html - Music gallery
  - site/about/index.html - About page
  - site/subscribe/index.html - Newsletter page
  - site/posts/{slug}/index.html - Individual article pages
  - site/data/notion.json - Raw Notion data cache

**Important:** Never edit HTML files directly - they're overwritten on every build. Edit the build script instead.

---

## Architecture Overview

**How It Works:**
1. GitHub Actions runs on schedule (hourly) or manual trigger
2. Build script calls Notion API to fetch all published items
3. For each item, script generates appropriate HTML based on "Kind" property
4. Security headers, navigation, and styling added to all pages
5. Static files deployed to GitHub Pages
6. Site is live at: https://koltregaskes.github.io/notion-site-test/

**Data Flow:**
```
Notion Database (Content)
    ↓
Notion API (Fetch)
    ↓
fetch-notion.mjs (Build Script)
    ↓
site/ folder (Static HTML/CSS)
    ↓
GitHub Pages (Hosting)
    ↓
Live Website
```

**Content Types (Kind Property):**
- **article** - Blog posts with full HTML rendering, table of contents, tags
- **image** - Photos/graphics shown in gallery grid, modal viewer with navigation
- **video** - Videos shown in gallery grid, modal viewer with controls
- **music** - Audio files with placeholder (player coming in Sprint 3)

For detailed architecture, see: [ARCHITECTURE.md](ARCHITECTURE.md)

---

## Common Tasks

### Adding a New Feature to Home Page
1. Read: scripts/fetch-notion.mjs (lines 538-738)
2. Modify: `writeHomePage()` function
3. Add CSS: site/styles.css
4. Test locally: `node scripts/fetch-notion.mjs`
5. Update: CHANGELOG.md

### Adding a New Content Type (Kind)
1. Add to Notion database: New option in Kind property
2. Update: scripts/fetch-notion.mjs
   - Add to `writeGalleryPage()` calls (around line 1230)
   - Update navigation in `getHeaderFooter()` (lines 310-316)
3. Add CSS: site/styles.css (if needed)
4. Update docs: USAGE.md, SETUP.md

### Changing Design/Colours
1. Edit: site/styles.css
2. Modify: CSS custom properties (lines 1-50)
3. Test locally: Build site and view in browser
4. Update: CHANGELOG.md

### Adding Security Headers
1. Edit: scripts/fetch-notion.mjs
2. Modify: `getSecurityHeaders()` function (lines 13-19)
3. All pages automatically include headers on next build

### Adding API Integration (e.g., Claude API for summaries)
1. Add secret: GitHub repo → Settings → Secrets → Actions
2. Edit: scripts/fetch-notion.mjs
3. Add API call in appropriate function (e.g., `writeArticlePage()`)
4. Update: COSTS.md with pricing breakdown
5. Update: README.md with required secret

---

## Notion Database Structure

**Required Properties:**
- **Name** (Title) - Content title
- **Kind** (Select) - Type: article, image, video, music
- **Publish** (Checkbox) - Must be ON to appear on site
- **Summary** (Text) - Optional short description (1-2 sentences)
- **Tags** (Multi-select) - Categories for filtering
- **Upload** (Files & Media) - Upload images/videos/MP3s directly
- **Drive URL** (URL) - Alternative to Upload (use Google Drive links, etc.)

**How It Works:**
- Only items with Publish = ON are fetched
- Kind determines which page type is generated
- Articles need Notion page content (blocks) to render
- Media items need either Upload files or Drive URL

For setup instructions, see: [SETUP.md](SETUP.md)

---

## Recent Changes (v2.1.0)

### Sprint 1 & 2 Completed (December 2025)
1. **Home page redesign** - 4-column grid showing all content types with filters
2. **Gallery navigation** - Prev/next buttons, keyboard shortcuts, mouse wheel support
3. **Music support** - New Kind option with dedicated gallery page
4. **Security headers** - CSP, XSS protection, anti-clickjacking
5. **Gallery protection** - Right-click blocking, no download buttons
6. **Newsletter page** - Fixed 405 error, added subscription preferences

For full changelog, see: [CHANGELOG.md](CHANGELOG.md)

---

## File Modification Frequency

**Frequently Modified:**
- scripts/fetch-notion.mjs - Main build script (every feature update)
- site/styles.css - Styling (design changes)
- CHANGELOG.md - Version tracking (every release)
- TODO.md - Task tracking (ongoing)

**Occasionally Modified:**
- .github/workflows/pages.yml - CI/CD changes
- README.md - Documentation updates
- COSTS.md - When adding paid services

**Rarely Modified:**
- SETUP.md - Initial setup instructions
- ARCHITECTURE.md - Major architectural changes only
- TROUBLESHOOTING.md - When new issues discovered

---

## Dependencies

**Runtime:**
- Node.js 18+ (native modules only, no npm packages)
- Uses: fetch, fs/promises, path

**Build/Deploy:**
- GitHub Actions (free tier: 2,000 minutes/month)
- Notion API (free tier: 3 requests/second)

**Local Development:**
- http-server (npx http-server) for local preview

**No Package Manager Required:**
- Zero npm dependencies in production
- All code uses Node.js built-in modules
- http-server only used for local testing (npx runs it on-demand)

---

## API Rate Limits

**Notion API:**
- 3 requests per second (averaged over 1 minute)
- Current usage: 1 request/hour (~720/month)
- Headroom: 99.9% under limit

**GitHub Actions:**
- 2,000 minutes/month (free tier)
- Current usage: ~1,440 minutes/month (24 builds/day × 2 min/build)
- Headroom: 560 minutes/month spare

For cost breakdown, see: [COSTS.md](COSTS.md)

---

## Secrets and Environment Variables

**Required:**
- `NOTION_TOKEN` - Get from https://www.notion.so/my-integrations
- `NOTION_DATABASE_ID` - Copy from Notion database URL

**Future (Not Yet Used):**
- `ANTHROPIC_API_KEY` - For AI-generated summaries (Sprint 5+)
- `TWITTER_API_KEY` - For newsletter automation (Sprint 6+)

**Where to Set:**
- **GitHub:** Repo → Settings → Secrets and variables → Actions
- **Local:** PowerShell `$env:VAR="value"` or Mac/Linux `export VAR="value"`

Never commit secrets to git. They're in .gitignore.

---

## Testing

**Manual Testing:**
1. Build locally: `node scripts/fetch-notion.mjs`
2. Check for errors in console output
3. Serve: `cd site && npx http-server -p 8080`
4. Open: http://localhost:8080/notion-site-test/
5. Test:
   - Home page grid and filters work
   - Gallery modal navigation (prev/next, keyboard, mouse wheel)
   - Mobile responsive layout
   - All navigation links work
   - Images/videos load correctly

**Automated Testing:**
- GitHub Actions runs build on every push
- Build fails if Notion API errors or HTML generation fails
- No unit tests currently (all integration testing)

**Accessibility Testing:**
See: [ACCESSIBILITY.md](ACCESSIBILITY.md)

---

## Known Issues and Limitations

**Gallery Protection:**
- Right-click blocking is basic level only
- Advanced users can still access files via browser DevTools
- Stops ~95% of casual users

**Newsletter:**
- Form is non-functional (shows visual feedback only)
- Requires third-party service integration (Buttondown/Substack)
- Planned for future sprint

**Music Player:**
- Currently just displays placeholders
- No audio playback yet (Sprint 3 planned)
- Files upload to Notion but don't play on site

For troubleshooting, see: [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

---

## Deployment

**Automatic:**
- Every hour at :17 minutes past the hour
- GitHub Actions runs, builds, deploys
- No manual intervention needed

**Manual Trigger:**
1. Go to GitHub repo → Actions tab
2. Click "pages" workflow
3. Click "Run workflow" button
4. Wait ~2 minutes for build to complete

**Live Site:**
https://koltregaskes.github.io/notion-site-test/

---

## Next Steps (Roadmap)

**Sprint 3: Music Player (Planned)**
- HTML5 audio player in music gallery
- Play/pause controls, volume, progress bar
- Music visualizer (frequency bars)

**Sprint 4: Persistent Player (Planned)**
- Sidebar music player across all pages
- Playlist management, shuffle, repeat modes

**Sprint 5: AI Integration (Planned)**
- Auto-generate article summaries (Claude API)
- Cache summaries to avoid regeneration
- Cost: ~$0.06-0.30/month

**Sprint 6: Newsletter Automation (Planned)**
- X/Twitter API integration for content gathering
- AI-powered newsletter generation
- Admin editor interface

For complete roadmap, see: [TODO.md](TODO.md)

---

## Support and Documentation

**Primary Docs:**
- [README.md](README.md) - Project overview and quick start
- [SETUP.md](SETUP.md) - Initial setup instructions
- [USAGE.md](USAGE.md) - How to use features
- [ARCHITECTURE.md](ARCHITECTURE.md) - Technical details
- [CHANGELOG.md](CHANGELOG.md) - Version history
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Common issues
- [COSTS.md](COSTS.md) - Cost breakdown and estimates
- [ACCESSIBILITY.md](ACCESSIBILITY.md) - Accessibility standard

**Sprint Docs:**
- [SPRINT1-COMPLETE.md](SPRINT1-COMPLETE.md) - Security & home page
- [SPRINT2-COMPLETE.md](SPRINT2-COMPLETE.md) - Gallery navigation
- [HOME-PAGE-COMPLETE.md](HOME-PAGE-COMPLETE.md) - Home page details
- [CURRENT-STATUS.md](CURRENT-STATUS.md) - What's working now

**AI/Tooling:**
- [llms.txt](llms.txt) - This file
- [AGENTS.md](AGENTS.md) - Guide for AI agents working on this repo

---

## Contact and Links

- **Live Site:** https://koltregaskes.github.io/notion-site-test/
- **GitHub Repo:** https://github.com/koltregaskes/notion-site-test
- **Notion Integrations:** https://www.notion.so/my-integrations
- **GitHub Actions:** https://github.com/koltregaskes/notion-site-test/actions

---

**This file is maintained as the primary onboarding document for LLMs and AI agents working with this repository. Keep it updated when major changes occur.**
